local a=require("component")local b=require("computer")local c=require("config")local d={}local e;function d.reload()e=c.load("/etc/vtcolors.cfg")end;d.reload()function d.emu(f)checkArg(1,f,"table")local g,h=f.maxResolution()f.setResolution(g,h)local i,j,g,h=1,1,f.getResolution()local k,l=1,1;local m=true;local n=false;local o=true;local p=""local q=""local r=0;local s=e.normal or{0x000000,0xDD0000,0x00DD00,0x0000DD,0xDDDD00,0xDD00DD,0x00DDDD,0xDDDDDD}local t=e.bright or{0x111111,0xFF0000,0x00FF00,0xFFFF00,0x0000FF,0xFF00FF,0x00FFFF,0xFFFFFF}local u,v=0xFFFFFF,0x000000;local function w()if i>g then i,j=1,j+1 end;if j>h then f.copy(1,1,g,h,0,-1)f.fill(1,h,g,1," ")j=h end;if i<1 then i=g;j=j-1 end;if j<1 then j=1 end end;local function x()while#p>0 do w()local y=p:sub(1,g-i+1)p=p:sub(#y+1)if m then f.set(i,j,y)end;i=i+#y end end;local function z(A)checkArg(1,A,"string")A=A:gsub("\8","\27[D")local B=""g,h=f.getResolution()local C=f.get(i,j)f.setForeground(u)f.setBackground(v)f.set(i,j,C)for D in A:gmatch(".")do if r==0 then if D=="\n"then x()i,j=1,j+1 elseif D=="\t"then p=p..(" "):rep(math.max(1,(i+4)%8))elseif D=="\27"then x()r=1 else p=p..D end elseif r==1 then if D=="["then r=2 else if D=="D"then f.copy(1,1,g,h,0,-1)f.fill(1,h,g,1," ")elseif D=="M"then f.copy(1,1,g,h,0,1)f.fill(1,1,g,1," ")elseif D=="7"then k,l=i,j elseif D=="8"then i,j=k,l end;r=0 end elseif r==2 then if D:match("[%d;]")then q=q..D else r=0;local E={}for F in q:gmatch("%d+")do E[#E+1]=tonumber(F)end;if D=="H"then i,j=math.min(g,E[2]or 1),math.min(h,E[1]or 1)elseif D=="A"then j=j-(E[1]or 1)elseif D=="B"then j=j+(E[1]or 1)elseif D=="C"then i=i+(E[1]or 1)elseif D=="D"then i=i-(E[1]or 1)elseif D=="E"then i,j=1,j+(E[1]or 1)elseif D=="F"then i,j=1,j-(E[1]or 1)elseif D=="f"then i,j=math.min(g,E[2]or 1),math.min(h,E[1]or 1)elseif D=="s"then k,l=i,j elseif D=="u"then i,j=k,l elseif D=="n"then if E[1]==6 then B=string.format("%s\27[%d;%dR",B,j,i)elseif E[1]==5 then B=string.format("%s\27[%dn",B,f and f.getScreen()and 0 or 3)end elseif D=="c"then B=string.format("%s\27[?1;ocansi0c",B)elseif D=="K"then if E[1]==1 then f.fill(1,j,i,1," ")elseif E[1]==2 then f.fill(i,j,g,1," ")elseif not E[1]or E[1]==0 then f.fill(1,j,g,1," ")end elseif D=="J"then if E[1]==1 then f.fill(1,1,g,j," ")elseif E[1]==2 then f.fill(1,1,g,h," ")i,j=1,1 elseif not E[1]or E[1]==0 then f.fill(1,j,g,h," ")end elseif D=="S"then f.copy(1,1,g,h,0,-1)f.fill(1,h,g,1," ")elseif D=="T"then f.copy(1,1,g,h,0,1)f.fill(1,1,g,1," ")elseif D=="m"then if#E==0 then m=true;u=s[8]v=s[1]end;for G=1,#E,1 do local H=E[G]if H==8 then m=false elseif H==28 then m=true elseif H==0 then m=true;u=s[8]v=s[1]elseif H==7 or H==27 then u,v=v,u elseif H>29 and H<38 then u=s[H-29]elseif H==39 then u=s[8]elseif H>39 and H<48 then v=s[H-39]elseif H>89 and H<98 then u=t[H-89]elseif H>99 and H<108 then v=t[H-99]elseif H==255 then o=not o end end;local I=f.getDepth()if I>1 or u==s[1]or u==s[8]or v==t[1]or v==t[8]then f.setForeground(u)end;if I>1 or v==s[1]or v==s[8]or v==t[1]or v==t[8]then f.setBackground(v)end end;q=""w()end end end;x()w()if o then local D,J,K=f.get(i,j)f.setForeground(K)f.setBackground(J)f.set(i,j,D)f.setForeground(u)f.setBackground(v)end;if B~=""then b.pushSignal("vt_response",f.getScreen(),B)B=""end end;return z end;return d
